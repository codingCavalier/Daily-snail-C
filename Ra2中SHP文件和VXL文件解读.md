### 引用资源
- https://modenc.renegadeprojects.com/SHP
- https://www.bilibili.com/opus/1067600093788504089?spm
- https://www.bilibili.com/read/cv36402416/?opus_fallback=1

### 1、文件头数据结构
- 00-01字节，无意义
- 02-03字节，图片宽度
- 04-05字节，图片高度
- 06-07字节，动画总帧数

### 2、帧头数据结构
- 00-01字节，表示此帧存在颜色信息的像素的最小X坐标，注意坐标是从0开始的（定义left）（画面范围是一个矩形）
- 02-03字节，表示此帧存在颜色信息的像素的最小Y坐标，注意坐标是从0开始的（定义top）
- 04-05字节，表示此帧的有效区域宽度，也就是最小X坐标到最大X坐标间的像素个数（定义right=left+w）
- 06-07字节，表示此帧的有效区域高度，也就是最小Y坐标到最大Y坐标间的像素个数（定义bottom=top+h）
- 08-11字节，表示此帧的帧类型，目前已发现的有00，01和03两种值，数据区解析时会用到这个值（00、01较少见，一般用于帧中像素个数很少的情况；03为常见值）
- 12-15字节，未破解其意义
- 16-19字节，表示分隔符
- 20-23字节，表示此帧画面的数据区数据在文件中的第一个下标

### 3、数据区数据结构
- 帧头数据和数据区数据是一一对应的
- 帧类型为00或01时
  - 数据区的数据全是颜色下标
  - 帧头中已经确定了最小XY坐标，有效区域高度h宽度w，那么h*w个字节的数据全是颜色下标数据
- 帧类型为03时
  - 如果前2个字节是0x04，表示此行没有数据，需要跳过下两个字节（跳过第3、4字节）
  - 如果前2个字节不是0x04，例如前两个字节是0x07表示此行有7个字节，第3个字节00表示此行像素最小X坐标值不是帧像素X坐标最小值，第4个字节0x19表示第一个像素X坐标大于帧最小X坐标25个像素
  - 第5个字节0x0A表示颜色下标，第6个字节00表示此行像素最大X坐标值不是帧像素X坐标最大值，第7个字节0x25表示最后一个像素X坐标小于帧最大X坐标36个像素（36=0x25-0x1）
  - 我们简称这个模式叫做 `2+2+N+2` 模式，即2个字节表示行字节长度，2个字节表示起始位置，N个字节表示像素颜色下标（是调色盘中的下标，通过下标在调色盘文件中可以找到对应的颜色），2个字节表示末尾位置
  - `2+N+2` 模式（比 `2+2+N+2` 模式少了第二个2），表示第一个像素的X坐标是帧像素X最小值
  - `2+2+N` 模式（比 `2+2+N+2` 模式少了最后一个2），表示最后一个像素的X坐标是帧像素X最大值
  - `2+N` 模式（比 `2+2+N+2` 模式少了第二个2和最后一个2），表示行X最小值等于帧X最小值，且行X最大值等于帧X最大值
  - 另外还有一种特殊情况，当行的中间出现像素值0，看起来行中间被“挖空”了，0的下一个值将表示此处有几个空像素，而这个值将不表示颜色值
- 当一帧的数据区数据解析完之后，需要补齐8位，补若干个0使当前的数据整齐，这在一些旧的系统或者文件中也常见

### VXL文件
### 1、文件头数据结构
- 00-0F字节，固定的16个字节（56 6F 78 65 6C 20 41 6E  69 6D 61 74 69 6F 6E 00），即前面的15个字节（Voxel Animation）加上末尾的00
- 10-13字节，色盘计数，一般都只有1个色盘
- 14-17字节，区块数量，一般都是1
- 18-1B字节，未破解其意义
- 1C-1F字节，表示数据区的字节数
- 20-21字节，未破解其意义

### 2、调色盘数据结构
- 768个字节，调色盘颜色区，包括了256个颜色值，每3个字节表示一个RGB颜色值
  - 此处颜色值与SHP文件对应的调色盘有差别，**SHP的调色盘里的单个字节的数值需要乘4，才是正常的颜色值**
- 24个字节，16个字节表示Section名称，4个字节是一个int表示Tailor的对应关系（00 00 00 00），4个字节是一个int未破解其意义（01 00 00 00）
        **44 55 4D 4D 59 30  31 00 11 00 00 00 11 00
  00 00** 00 00 00 00 01 00  00 00

### 3、数据区
- 先想象空间直角坐标系中，在Z=0这个平面上，在(X,Y)直角坐标系第一象限中（右上角），放着一个3X3魔方，
  - 我们用x=1,x=2和y=1,y=2，四个平面把它平均切成9束，再用z=1,z=2，两个平面把每一束切成3个小块，一共有3x9=27个小块
  - 对于每一束的底部和顶部，我们需要进行保存，把底部的坐标都保存进第一数组，把顶部的坐标都保存进第二数组，然后把每一束的每一个小方块保存进第三数组
  - 第一数组，就是数据区的第一部分
  - 第二数组，就是数据区的第二部分
  - 第三数组，就是数据区的第三部分
  - 第一数组和第二数组的长度是一样的
  - 数据区由这三个数组构成
- 综上可知，第一数组存的是每一束的底部坐标，第二数组存的是每一束的顶部坐标，第三数组存的是每一束的真实数据

### 4、文件尾数据结构（92个字节）
- 00-03字节，4个字节，表示在数据区中第一数组的起始下标
- 04-07字节，4个字节，表示在数据区中第二数组的起始下标
- 08-0B字节，4个字节，表示在数据区中第三数组的起始下标
- 0C-0F字节，4个字节，表示缩放倍数参数，用不上
- 10-3F字节，48个字节，表示一个3D变换矩阵，用不上
- 40-57字节，24个字节，用不上
- 58-5B字节，4个字节，第一个表示这个模型X坐标方向像素个数，设为a，第二个字节表示这个模型Y坐标方向像素个数，设为b，第三个表示这个模型Z坐标方向像素个数，设为c

### 5、数据区解析
- 第一数组的长度是a*b吗？并不是
  - 但是，第一数组中的前a*b个元素是那一束底部元素在第三数组的下标
  - 同理，第二数组中的前a*b个元素是那一束顶部元素在第三数组的下标

举个例子说明，比如第一数组第一个元素是A1，第二数组第一个元素是B1，第三数组用Arr表示，那么第一束信息可在第三数组中Arr[A1]到Arr[B1]间获取，第二束信息就是Arr[A2]到Arr[B2]间获取

注意：当An小于0时，表示这一束一个方块也没有，自然不需要从第三数组中获取数据

由此可以看出，在第三数组中，数据是一段一段的，就称每一段为数据段吧，每一数据段又如何表达这一束小方块呢？

### 数据段数据结构
- 00字节，表示此束第一个小方块在Z轴上的坐标
- 01字节，表示这一束有几个小方块
- 02-03字节，02字节表示颜色下标，03字节表示法线数据
  - 照此方式，2个字节为一组，一直往后取值
